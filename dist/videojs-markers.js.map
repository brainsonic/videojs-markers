{"version":3,"sources":["videojs-markers.js"],"names":["$","videojs","undefined","defaultSetting","markerStyle","markerTip","display","text","marker","html","time","breakOverlay","displayTime","overlayText","style","onMarkerClick","onMarkerReached","index","markers","generateUUID","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","NULL_INDEX","registerVideoJsMarkersPlugin","options","console","log","setting","extend","markersMap","markersList","videoWrapper","el","currentMarkerIndex","player","overlayIndex","sortMarkersList","sort","a","b","addMarkers","newMarkers","forEach","key","find","append","createMarkerDiv","push","getPosition","duration","markerDiv","css","parseFloat","attr","class","addClass","on","e","preventDefault","data","currentTime","registerMarkerTipHandler","updateMarkers","markerTime","removeMarkers","indexArray","deleteIndexList","remove","reverse","deleteIndex","splice","width","fnSetCorrectPosition","setTimeout","initializeMarkerTip","updateBreakOverlay","initializeOverlay","onTimeUpdate","onUpdateMarker","onTimeUpdateAfterMarkerUpdate","length","getNextMarkerTime","newMarkerIndex","nextMarkerTime","i","initialize","removeAll","getMarkers","next","prev","add","updateTime","reset","destroy","off","plugin","jQuery","window"],"mappings":"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","file":"videojs-markers.js","sourcesContent":["/*! videojs-markers - v0.7.0 - 2016-12-19\n* Copyright (c) 2016 ; Licensed  */\n'use strict';\n\ntype Marker = {\n  time: number,\n  text?: string,\n  html?: string,\n  class?: string,\n  overlayText?: string,\n  // private property\n  key: string,\n};\n\n(function($, videojs, undefined) {\n  // default setting\n  const defaultSetting = {\n    markerStyle: {\n      'width':'7px',\n      'border-radius': '30%',\n      'background-color': 'red',\n    },\n    markerTip: {\n      display: true,\n      text: function(marker) {\n        return marker.text;\n      },\n      html: function(marker) {\n        return marker.html ? marker.html : marker.text;\n      },\n      time: function(marker) {\n        return marker.time;\n      },\n    },\n    breakOverlay:{\n      display: false,\n      displayTime: 3,\n      text: function(marker) {\n        return marker.overlayText;\n      },\n      style: {\n        'width':'100%',\n        'height': '20%',\n        'background-color': 'rgba(0,0,0,0.7)',\n        'color': 'white',\n        'font-size': '17px',\n      },\n    },\n    onMarkerClick: function(marker) {},\n    onMarkerReached: function(marker, index) {},\n    markers: [],\n  };\n\n  // create a non-colliding random number\n  function generateUUID(): string {\n    var d = new Date().getTime();\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      var r = (d + Math.random()*16)%16 | 0;\n      d = Math.floor(d/16);\n      return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n    });\n    return uuid;\n  };\n\n  const NULL_INDEX = -1;\n\n  function registerVideoJsMarkersPlugin(options) {\n    /**\n     * register the markers plugin (dependent on jquery)\n     */\n    console.log(\"initing MARKERS plugin\");\n    \n    let setting = $.extend(true, {}, defaultSetting, options),\n        markersMap: {[key:string]: Marker} = {},\n        markersList: Array<Marker>  = [], // list of markers sorted by time\n        videoWrapper = $(this.el()),\n        currentMarkerIndex  = NULL_INDEX,\n        player       = this,\n        markerTip    = null,\n        breakOverlay = null,\n        overlayIndex = NULL_INDEX;\n\n    function sortMarkersList(): void {\n      // sort the list by time in asc order\n      markersList.sort((a, b) => {\n        return setting.markerTip.time(a) - setting.markerTip.time(b);\n      });\n    }\n\n    function addMarkers(newMarkers: Array<Marker>): void {\n      newMarkers.forEach((marker: Marker) => {\n        marker.key = generateUUID();\n\n        videoWrapper.find('.vjs-progress-holder')\n          .append(createMarkerDiv(marker));\n\n        // store marker in an internal hash map\n        markersMap[marker.key] = marker;\n        markersList.push(marker);\n      })\n\n      sortMarkersList();\n    }\n\n    function getPosition(marker: Marker): number {\n      return (setting.markerTip.time(marker) / player.duration()) * 100;\n    }\n\n    function createMarkerDiv(marker: Marker): Object {\n      var markerDiv = $(\"<div class='vjs-marker'></div>\");\n      markerDiv\n        .css(setting.markerStyle)\n        .css({\n          \"margin-left\" : -parseFloat(markerDiv.css(\"width\"))/2 + 'px',\n          \"left\" : getPosition(marker) + '%',\n        })\n        .attr(\"data-marker-key\", marker.key)\n        .attr(\"data-marker-time\", setting.markerTip.time(marker));\n\n      // add user-defined class to marker\n      if (marker.class) {\n        markerDiv.addClass(marker.class);\n      }\n\n      // bind click event to seek to marker time\n      markerDiv.on('click', function(e) {\n        var preventDefault = false;\n        if (typeof setting.onMarkerClick === \"function\") {\n          // if return false, prevent default behavior\n          preventDefault = setting.onMarkerClick(marker) === false;\n        }\n\n        if (!preventDefault) {\n          var key = $(this).data('marker-key');\n          player.currentTime(setting.markerTip.time(markersMap[key]));\n        }\n      });\n\n      if (setting.markerTip.display) {\n        registerMarkerTipHandler(markerDiv);\n      }\n\n      return markerDiv;\n    }\n\n    function updateMarkers(): void {\n      // update UI for markers whose time changed\n      markersList.forEach((marker: Marker) => {\n        var markerDiv = videoWrapper.find(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\n        var markerTime = setting.markerTip.time(marker);\n\n        if (markerDiv.data('marker-time') !== markerTime) {\n          markerDiv\n          .css({\"left\": getPosition(marker) + '%'})\n          .attr(\"data-marker-time\", markerTime);\n        }\n      });\n      sortMarkersList();\n    }\n\n    function removeMarkers(indexArray: Array<number>): void {\n      // reset overlay\n      if (!!breakOverlay){\n        overlayIndex = NULL_INDEX;\n        breakOverlay.css(\"visibility\", \"hidden\");\n      }\n      currentMarkerIndex = NULL_INDEX;\n\n      let deleteIndexList: Array<number> = [];\n      indexArray.forEach((index: number) => {\n        let marker = markersList[index];\n        if (marker) {\n          // delete from memory\n          delete markersMap[marker.key];\n          deleteIndexList.push(index);\n\n          // delete from dom\n          videoWrapper.find(\".vjs-marker[data-marker-key='\" + marker.key +\"']\").remove();\n        }\n      });\n\n      // clean up markers array\n      deleteIndexList.reverse();\n      deleteIndexList.forEach((deleteIndex: number) => {\n        markersList.splice(deleteIndex, 1);\n      })\n\n      // sort again\n      sortMarkersList();\n    }\n\n    // attach hover event handler\n    function registerMarkerTipHandler(markerDiv: Object): void {\n      markerDiv.on('mouseover', () => {\n        var marker = markersMap[$(markerDiv).data('marker-key')];\n\n        if (!!markerTip) {\n          if(marker.html)\n          {\n            markerTip.find('.vjs-tip-inner').html(setting.markerTip.html(marker));\n          }else{\n            markerTip.find('.vjs-tip-inner').text(setting.markerTip.text(marker));\n          }\n\n          // margin-left needs to minus the padding length to align correctly with the marker\n          markerTip.css({\n            \"left\" : getPosition(marker) + '%',\n            \"margin-left\" : -parseFloat(markerTip.width()) / 2 - 5 + 'px',\n            \"visibility\"  : \"visible\",\n          });\n          \n          //second call to detect better image size\n          var fnSetCorrectPosition = function() {\n                               markerTip.css({\n                                 \"left\" : getPosition(marker) + '%',\n                                 \"margin-left\" : -parseFloat(markerTip.width()) / 2 - 5 + 'px'\n                                });\n                             };\n          setTimeout(fnSetCorrectPosition, 50);\n          setTimeout(fnSetCorrectPosition, 100);\n          setTimeout(fnSetCorrectPosition, 200);\n          setTimeout(fnSetCorrectPosition, 300);\n          setTimeout(fnSetCorrectPosition, 400);\n        }\n\n      });\n\n      markerDiv.on('mouseout',() => {\n        !!markerTip && markerTip.css(\"visibility\", \"hidden\");\n      });\n    }\n\n    function initializeMarkerTip(): void {\n      markerTip = $(\"<div class='vjs-tip'><div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div></div>\");\n      videoWrapper.find('.vjs-progress-holder').append(markerTip);\n    }\n\n    // show or hide break overlays\n    function updateBreakOverlay(): void {\n      if (!setting.breakOverlay.display || currentMarkerIndex < 0) {\n        return;\n      }\n\n      var currentTime = player.currentTime();\n      var marker = markersList[currentMarkerIndex];\n      var markerTime = setting.markerTip.time(marker);\n\n      if (\n        currentTime >= markerTime &&\n        currentTime <= (markerTime + setting.breakOverlay.displayTime)\n      ) {\n        if (overlayIndex !== currentMarkerIndex) {\n          overlayIndex = currentMarkerIndex;\n          breakOverlay && breakOverlay.find('.vjs-break-overlay-text').html(setting.breakOverlay.text(marker));\n        }\n\n        breakOverlay && breakOverlay.css('visibility', \"visible\");\n      } else {\n        overlayIndex = NULL_INDEX;\n        breakOverlay && breakOverlay.css(\"visibility\", \"hidden\");\n      }\n    }\n\n    // problem when the next marker is within the overlay display time from the previous marker\n    function initializeOverlay(): void {\n      breakOverlay = $(\"<div class='vjs-break-overlay'><div class='vjs-break-overlay-text'></div></div>\")\n      .css(setting.breakOverlay.style);\n      videoWrapper.append(breakOverlay);\n      overlayIndex = NULL_INDEX;\n    }\n\n    function onTimeUpdate(): void {\n      onUpdateMarker();\n      updateBreakOverlay();\n      options.onTimeUpdateAfterMarkerUpdate && options.onTimeUpdateAfterMarkerUpdate();\n    }\n\n    function onUpdateMarker() {\n      /*\n        check marker reached in between markers\n        the logic here is that it triggers a new marker reached event only if the player\n        enters a new marker range (e.g. from marker 1 to marker 2). Thus, if player is on marker 1 and user clicked on marker 1 again, no new reached event is triggered)\n      */\n      if (!markersList.length) {\n        return;\n      }\n\n      var getNextMarkerTime = (index: number) => {\n        if (index < markersList.length - 1) {\n          return setting.markerTip.time(markersList[index + 1]);\n        }\n        // next marker time of last marker would be end of video time\n        return player.duration();\n      }\n      var currentTime = player.currentTime();\n      var newMarkerIndex = NULL_INDEX;\n\n      if (currentMarkerIndex !== NULL_INDEX) {\n        // check if staying at same marker\n        var nextMarkerTime = getNextMarkerTime(currentMarkerIndex);\n        if(\n          currentTime >= setting.markerTip.time(markersList[currentMarkerIndex]) &&\n          currentTime < nextMarkerTime\n        ) {\n          return;\n        }\n\n        // check for ending (at the end current time equals player duration)\n        if (\n          currentMarkerIndex === markersList.length - 1 &&\n          currentTime === player.duration()\n        ) {\n          return;\n        }\n      }\n\n      // check first marker, no marker is selected\n      if (currentTime < setting.markerTip.time(markersList[0])) {\n        newMarkerIndex = NULL_INDEX;\n      } else {\n        // look for new index\n        for (var i = 0; i < markersList.length; i++) {\n          nextMarkerTime = getNextMarkerTime(i);\n          if (\n            currentTime >= setting.markerTip.time(markersList[i]) &&\n            currentTime < nextMarkerTime\n          ) {\n            newMarkerIndex = i;\n            break;\n          }\n        }\n      }\n\n      // set new marker index\n      if (newMarkerIndex !== currentMarkerIndex) {\n        // trigger event if index is not null\n        if (newMarkerIndex !== NULL_INDEX && options.onMarkerReached) {\n          options.onMarkerReached(markersList[newMarkerIndex], newMarkerIndex);\n        }\n        currentMarkerIndex = newMarkerIndex;\n      }\n    }\n\n    // setup the whole thing\n    function initialize(): void {\n      if (setting.markerTip.display) {\n        initializeMarkerTip();\n      }\n\n      // remove existing markers if already initialized\n      player.markers.removeAll();\n      addMarkers(options.markers);\n\n      if (setting.breakOverlay.display) {\n        initializeOverlay();\n      }\n      onTimeUpdate();\n      player.on(\"timeupdate\", onTimeUpdate);\n    }\n\n    // setup the plugin after we loaded video's meta data\n    player.on(\"loadedmetadata\", function() {\n      initialize();\n    });\n\n    // exposed plugin API\n    player.markers = {\n      getMarkers: function(): Array<Marker> {\n        return markersList;\n      },\n      next : function(): void {\n        // go to the next marker from current timestamp\n        const currentTime = player.currentTime();\n        for (var i = 0; i < markersList.length; i++) {\n          var markerTime = setting.markerTip.time(markersList[i]);\n          if (markerTime > currentTime) {\n            player.currentTime(markerTime);\n            break;\n          }\n        }\n      },\n      prev : function(): void {\n        // go to previous marker\n        const currentTime = player.currentTime();\n        for (var i = markersList.length - 1; i >= 0 ; i--) {\n          var markerTime = setting.markerTip.time(markersList[i]);\n          // add a threshold\n          if (markerTime + 0.5 < currentTime) {\n            player.currentTime(markerTime);\n            return;\n          }\n        }\n      },\n      add : function(newMarkers: Array<Marker>): void {\n        // add new markers given an array of index\n        addMarkers(newMarkers);\n      },\n      remove: function(indexArray: Array<number>): void {\n        // remove markers given an array of index\n        removeMarkers(indexArray);\n      },\n      removeAll: function(): void {\n        var indexArray = [];\n        for (var i = 0; i < markersList.length; i++) {\n          indexArray.push(i);\n        }\n        removeMarkers(indexArray);\n      },\n      updateTime: function(): void {\n        // notify the plugin to update the UI for changes in marker times\n        updateMarkers();\n      },\n      reset: function(newMarkers: Array<Marker>): void {\n        // remove all the existing markers and add new ones\n        player.markers.removeAll();\n        addMarkers(newMarkers);\n      },\n      destroy: function(): void {\n        // unregister the plugins and clean up even handlers\n        player.markers.removeAll();\n        breakOverlay && breakOverlay.remove();\n        markerTip && markerTip.remove();\n        player.off(\"timeupdate\", updateBreakOverlay);\n        delete player.markers;\n      },\n    };\n  }\n\n  videojs.plugin('markers', registerVideoJsMarkersPlugin);\n\n})(jQuery, window.videojs);\n"]}